---
# Source: ssd/templates/cm/ssd-proxy-ws.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: ssd-proxy-ws
  namespace: onework2
  labels:
    env: dev
    app.kubernetes.io/name: ssd
data:
  nginx.conf: |-
    worker_processes auto;

    error_log  /var/log/ssd-v2/ssd-proxy-ws/error.log notice;
    pid        /tmp/openresty/nginx.pid;

    events {
      worker_connections  1024;
    }

    http {
        include       /usr/local/openresty/nginx/conf/mime.types;
        default_type  application/octet-stream;
        
        client_body_temp_path /tmp/openresty/nginx-client-body;
        proxy_temp_path       /tmp/openresty/nginx-proxy;
        fastcgi_temp_path     /tmp/openresty/nginx-fastcgi;
        uwsgi_temp_path       /tmp/openresty/nginx-uwsgi;
        scgi_temp_path        /tmp/openresty/nginx-scgi;
        
        
        log_format  main  '$remote_addr - $remote_user [$time_local] [$request_id] "$request" '
                  '$status $body_bytes_sent "$http_referer" '
                  '"$http_user_agent" "$http_x_forwarded_for"';
        

        sendfile     on;
        keepalive_timeout  65;

        large_client_header_buffers 4 256k;

        lua_shared_dict iam_proxy_access_token_cache 256m;
        lua_shared_dict ssd_proxy_privileges_cache 128m;
        lua_shared_dict ssd_proxy_realm_keys_cache 10m;
        lua_shared_dict ssd_proxy_refresh_token_cache 10m;

        init_by_lua_file /opt/ssd-proxy-service/src/initialize_ssd_proxy_environment.lua;
        resolver local=on valid=60s;

        map $http_upgrade $connection_upgrade {
            default upgrade;
            ''      close;
        }

        server {
            listen       3001;
            access_log  /var/log/ssd-v2/ssd-proxy-ws/access.log main;
            port_in_redirect off;
            root /usr/local/openresty/nginx/static;

            # Tracing block
            add_header x-request-id $request_id;
            proxy_set_header x-request-id $request_id;
            proxy_set_header x-b3-traceid $http_x_b3_traceid;
            proxy_set_header x-b3-spanid $http_x_b3_spanid;
            proxy_set_header x-b3-parentspanid $http_x_b3_parentspanid;
            proxy_set_header x-b3-sampled $http_x_b3_sampled;
            proxy_set_header x-b3-flags $http_x_b3_flags;
            proxy_set_header x-ot-span-context $http_x_ott_span_context;
            proxy_set_header x-ssd-mode works;

            location ~ /ssd/ssd-(role-manager|core-data|transaction-manager|ui-admin)/actuator(/|$)(.*) {
                deny all;
            }

            location = /health {
                access_log off;
                add_header Content-Type application/json;

                return 200 "{\"status\":\"pass\",\"releaseId\":\"1.17\",\"version\":\"1\",\"serviceId\":\"$hostname\",\"description\":\"health of ssd-proxy\"}";
            }

            location /ssd/jwt/privileges {
                add_header Content-Type text/plain;
                return 200 "[WS-Privileges] header: $http_ws_privileges\n\n[Authorization] header: $http_authorization\n\n[x-ssd-mode] header: $http_x_ssd_mode";
            }

            location /ssd/privileges {
                
                proxy_pass 'http://127.0.0.1:3001/ssd/jwt/privileges';
            }

            location ~ ^/ssd/styles/(.*) {
                try_files /styles/$1 =404;
            }

            location /login {
                default_type "text/html";
                alias  /usr/local/openresty/nginx/static/login.html;
            }

            location /ssd/login {
                default_type "text/html";
                alias  /usr/local/openresty/nginx/static/login.html;
            }

            location /ssd/proxy-static/js/ {
                default_type "text/html";
                alias  /usr/local/openresty/nginx/static/js/;
            }

            location /ssd/reset-password {
                default_type "text/html";
                alias  /usr/local/openresty/nginx/static/resetPassword.html;
            }

            location /ssd/send-reset-password {
                default_type "text/html";
                proxy_pass http://ssd-role-manager:28885/v2/users/password_reset;
            }

            location /ssd/reset-password-email {
                default_type "text/html";
                alias  /usr/local/openresty/nginx/static/checkEmail.html;
            }

            location /ssd/unauthorized {
                default_type "text/html";
                alias  /usr/local/openresty/nginx/static/errorPages/unauthorized.html;
            }

            location /ssd/sessionExpired {
                default_type "text/html";
                alias  /usr/local/openresty/nginx/static/errorPages/sessionExpired.html;
            }

            location /ssd/sessionLimits {
                default_type "text/html";
                alias  /usr/local/openresty/nginx/static/errorPages/sessionLimits.html;
            }

            location /ssd/auth {
                access_by_lua_file  /opt/ssd-proxy-service/src/iam/do_auth_in_kecycloak_v3.lua;
            }

            location /ssd {
              return 301 $scheme://$host/ssd/;
            }

            location /ssd/logout {
                access_by_lua_file  /opt/ssd-proxy-service/src/iam/invalidate_session_v3.lua;
            }

            location /ssd/ssd-transaction-manager/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                gzip on;
                gzip_types application/json;
                proxy_pass http://ssd-transaction-manager:28887/;
            }

            location /ssd/ssd-core-data/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                gzip on;
                gzip_types application/json;
                proxy_pass http://ssd-core-data:28888/;
            }

            location /ssd/ssd-side-menu-backend/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                gzip on;
                gzip_types application/json;
                proxy_pass http://ssd-side-menu-backend:28892/;
            }

            location = /ssd/ssd-core-data/v2/projects/context/filter {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                gzip on;
                gzip_types application/json;
                proxy_pass http://ssd-core-data:28888/v2/projects/context/filter2end;
            }

            location /ssd/ssd-role-manager/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                gzip on;
                gzip_types application/json;
                proxy_pass http://ssd-role-manager:28885/;
            }

            location /ssd/ssd-ui-admin/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                gzip on;
                gzip_types application/json;
                proxy_pass http://ssd-ui-admin:28886/;
            }

            location /ssd/ssd-cloud-admin {
                
                proxy_pass http://ssd-cloud-admin:58080/ssd/ssd-cloud-admin;
            }
                        
            location /ssd/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme https;
                proxy_set_header X-Forwarded-Proto  https;
                gzip on;
                gzip_types application/json;
                proxy_pass http://ssd-mfe-platform:3000/;
            }
            
            #location ~ ^/ssd/tools/swtr/a4/(?!.*remotes).*/static/(.*) {
            #    access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

            #    proxy_pass http://ssd-mfe-platform:3000/static/$2$is_args$args;
            #}
    
            location /ssd/host/static/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                proxy_pass http://ssd-mfe-platform:3000/static/;
            }
    
            location = /ssd/host/api/dashboard-layouts {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                
                add_header Content-Type application/json;
                return 200 '[]';
                
            }    
    
            location = /ssd/host/api/common-mf {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                
                add_header Content-Type application/json;
                return 200 '[]';
                
            }   
    
            location = /ssd/host/api/remote-routes {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                
                add_header Content-Type application/json;
                return 200 '[
                      {
                        "path": "/ssd/*",
                        "id": "ow",
                        "name": "OW",
                        "options": {
                          "name": "ow_export_app",
                          "url": "/ssd/external/ow/mf-manifest.json"
                        }
                      }
                    ]';
                
            }  
    
            location /ssd/host/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                proxy_pass http://ssd-mfe-platform:3000/;
            }  
    
            location ~ ^/ssd/(.*)/ssd-side-menu-backend/(.*) {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                gzip on;
                gzip_types application/json;
                proxy_pass http://ssd-side-menu-backend:28892/$2$is_args$args;
            }  
    
            location /ssd/external/ow/ssd/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                proxy_pass http://127.0.0.1:3001/ssd/;
            }
    
            location /ssd/external/ow/ {
                access_by_lua_block { if ngx.var['cookie_CONVEYOR_LOGOUT'] == 'true' then ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=;Path=/ssd; expires=Thu, 01 Jan 1970 00:00:00 GMT; Max-Age=0;"; return ngx.redirect('https://proxy.voda.ru/openid-connect-auth/logout'); end loadfile('/opt/ssd-proxy-service/src/privileges/assign_request_permissions.lua')(); }
                proxy_set_header Authorization $http_authorization;
                proxy_set_header Cookie $http_cookie;

                proxy_pass http://ssd-ui:3000/;
            }
    
            location /ssd/tools/track/groups/ {
                
                client_max_body_size 1000M;
                proxy_set_header Host               onework.voda.ru;
                proxy_set_header X-Forwarded-Proto  https;
                proxy_set_header X-Real-IP          $remote_addr;
                proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme https;
                proxy_set_header Upgrade            $http_upgrade;
                proxy_set_header Connection         $connection_upgrade;
                proxy_http_version 1.1;
                rewrite  ^  $request_uri;                                                              # get original URI
                rewrite  ^/ssd/tools/track/groups/(.*)  /$1  break; # drop /ssd/tools/track/groups prefix
                return 400;                                                                            # if the second rewrite doesn't work
                proxy_pass http://localhost/gitlab/groups$uri;
                proxy_read_timeout     90;
            }

            location /ssd/tools/track/ {
                
                client_max_body_size 1000M;
                proxy_set_header Host               onework.voda.ru;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Real-IP         $remote_addr;
                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme      https;
                proxy_http_version 1.1;
                proxy_set_header   Upgrade $http_upgrade;
                proxy_set_header   Connection $connection_upgrade;
                proxy_pass http://localhost/gitlab/;
            }

            location ~ ^/ssd/tools/track/(.*\.git.*) {
                client_max_body_size 1000M;
                proxy_set_header Host              onework.voda.ru;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Real-IP         $remote_addr;
                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme      https;
                proxy_pass http://localhost/gitlab/$1$is_args$args;
                proxy_read_timeout     90;
            }

            location = /ssd/tools/track/-/metrics {
                proxy_set_header Host              onework.voda.ru;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Real-IP         $remote_addr;
                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme      https;
                proxy_pass http://localhost/gitlab/-/metrics;
                proxy_read_timeout     90;
            }

            location /ssd/tools/track/assets/ {
                proxy_set_header Host              onework.voda.ru;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Real-IP         $remote_addr;
                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme      https;
                proxy_pass http://localhost/gitlab/assets/;
                proxy_read_timeout     90;
            }

            location /ssd/tools/track/sber_project_api/ {
                proxy_set_header Host              onework.voda.ru;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Real-IP         $remote_addr;
                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme      https;
                proxy_pass http://localhost/gitlab/sber_project_api/;
                proxy_read_timeout     90;
            }

            location /ssd/tools/track/api/ {
                client_max_body_size 1000M;
                proxy_set_header Host              onework.voda.ru;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Real-IP         $remote_addr;
                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme      https;
                rewrite  ^  $request_uri;                         # get original URI
                rewrite  ^/ssd/tools/track/api/(.*)  $1  break;   # drop /ssd/tools/track/api prefix
                return 400;                                       # if the second rewrite doesn't work
                proxy_pass http://localhost/gitlab/api/$uri;
                proxy_read_timeout     90;
            }

            location /integration/adapters/track/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port 443;
                proxy_set_header X-Forwarded-Ssl on;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header Referer https://onework.voda.ru/ssd/tools/track/;
                proxy_pass http://localhost/gitlab/;
            }

            location /ssd/tools/sonar/ {
                
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Host onework.voda.ru;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/ssd/tools/sonar/;
            }

            location /ssd/tools/sonar/api/ {
                client_max_body_size 100M;
                
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Host onework.voda.ru;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/ssd/tools/sonar/api/;
            }

            location /ssd/tools/sonar/batch/ {
                client_max_body_size 1000M;
                
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Host onework.voda.ru;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/ssd/tools/sonar/batch/;
            }

            location /ssd/tools/sonar/batch/index {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Host onework.voda.ru;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/ssd/tools/sonar/batch/index;
            }

            location /ssd/tools/sonar/batch/file {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Host onework.voda.ru;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/ssd/tools/sonar/batch/file;
            }

            location /integration/adapters/snr/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Host onework.voda.ru;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/ssd/tools/sonar/;
            }
            location = /ssd/tools/jenkins-ci/jnlpJars/agent.jar {
                proxy_pass http://localhost/ssd/tools/jenkins-ci/jnlpJars/agent.jar;
            }

            location = /ssd/tools/jenkins-ci/wsagents/ {
                
                proxy_http_version 1.1;
                proxy_set_header   Upgrade $http_upgrade;
                proxy_set_header   Connection "upgrade";
                proxy_pass http://localhost/ssd/tools/jenkins-ci/wsagents/;
            }

            location ~ ^/ssd/tools/jenkins-ci/computer/(.*)/jenkins-agent.jnlp {
                rewrite ^  $request_uri;
                rewrite ^/ssd/tools/jenkins-ci/(.*)  $1  break;
                return  400;
                proxy_pass http://localhost/ssd/tools/jenkins-ci/$uri;
                proxy_read_timeout     90;
            }

            location ~ ^/ssd/tools/jenkins-ci/tcpSlaveAgentListener/ {
                rewrite ^  $request_uri;
                rewrite ^/ssd/tools/jenkins-ci/(.*)  $1  break;
                return  400;
                proxy_pass http://localhost/ssd/tools/jenkins-ci/$uri;
                proxy_read_timeout     90;
            }

            location ~ ^/ssd/tools/jenkins-ci/(.+) {
                client_max_body_size 10M;
                
                rewrite  ^  $request_uri;
                rewrite  ^/ssd/tools/jenkins-ci/(.*)  $1  break;
                return 400;
                proxy_pass http://localhost/ssd/tools/jenkins-ci/$uri;
            }

            location /ssd/tools/jenkins-ci/ {
                
                proxy_pass http://localhost/ssd/tools/jenkins-ci/;
            }

            location /integration/adapters/jenkins-ci/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header Referer https://onework.voda.ru/ssd/tools/jenkins-ci/;
                proxy_set_header WS-Privileges '[]';
                proxy_pass http://localhost/ssd/tools/jenkins-ci/;
            }
            location = /ssd/tools/jenkins-cd/jnlpJars/agent.jar {
                proxy_pass http://localhost/ssd/tools/jenkins-cd/jnlpJars/agent.jar;
            }

            location = /ssd/tools/jenkins-cd/wsagents/ {
                
                proxy_http_version 1.1;
                proxy_set_header   Upgrade $http_upgrade;
                proxy_set_header   Connection "upgrade";
                proxy_pass http://localhost/ssd/tools/jenkins-cd/wsagents/;
            }

            location ~ ^/ssd/tools/jenkins-cd/computer/(.*)/jenkins-agent.jnlp {
                rewrite ^  $request_uri;
                rewrite ^/ssd/tools/jenkins-cd/(.*)  $1  break;
                return  400;
                proxy_pass http://localhost/ssd/tools/jenkins-cd/$uri;
                proxy_read_timeout     90;
            }

            location ~ ^/ssd/tools/jenkins-cd/tcpSlaveAgentListener/ {
                rewrite ^  $request_uri;
                rewrite ^/ssd/tools/jenkins-cd/(.*)  $1  break;
                return  400;
                proxy_pass http://localhost/ssd/tools/jenkins-cd/$uri;
                proxy_read_timeout     90;
            }

            location ~ ^/ssd/tools/jenkins-cd/(.+) {
                client_max_body_size 10M;
                
                rewrite  ^  $request_uri;
                rewrite  ^/ssd/tools/jenkins-cd/(.*)  $1  break;
                return 400;
                proxy_pass http://localhost/ssd/tools/jenkins-cd/$uri;
            }

            location /ssd/tools/jenkins-cd/ {
                
                proxy_pass http://localhost/ssd/tools/jenkins-cd/;
            }

            location /integration/adapters/jenkins-cd/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header Referer https://onework.voda.ru/ssd/tools/jenkins-cd/;
                proxy_set_header WS-Privileges '[]';
                proxy_pass http://localhost/ssd/tools/jenkins-cd/;
            }
    
            location /ssd/tools/sc-ci/ {
                
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                proxy_set_header x-ssd-mode works;
                proxy_pass https://localhost/sc-cd/;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            location ~ ^/ssd/tools/sc-ci/([^/]*)/([^/]*\.git)([/]*)$ {
                client_max_body_size 1000M;

                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Real-IP         $remote_addr;
                proxy_set_header x-ssd-mode works;
                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme      https;
                proxy_pass https://localhost/sc-cd/$1$is_args$args;
            }
    
            location /ssd/tools/sc-cd/ {
                
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                proxy_set_header x-ssd-mode works;
                proxy_pass https://localhost/sc-cd/;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            location ~ ^/ssd/tools/sc-cd/([^/]*)/([^/]*\.git)([/]*)$ {
                client_max_body_size 1000M;

                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Real-IP         $remote_addr;
                proxy_set_header x-ssd-mode works;
                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Scheme      https;
                proxy_pass https://localhost/sc-cd/$1$is_args$args;
            }
            location /ssd/tools/nexus-ci/ {
                
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                proxy_pass http://localhost/ssd/tools/nexus-ci/;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            location /ssd/tools/nexus-ci/repository/ {
                
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                proxy_pass http://localhost/ssd/tools/nexus-ci/repository/;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            location /ssd/tools/nexus-ci/service/rest/ {
                
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                rewrite ^ $request_uri;
                rewrite ^/ssd/tools/nexus-ci/service/rest/(.*) $1 break;
                return 400;
                proxy_pass http://localhost/ssd/tools/nexus-ci/service/rest/$uri;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            location /ssd/tools/nexus-ci/repositoryplain/ {
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                proxy_pass http://localhost/ssd/tools/nexus-ci/repository/;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            # Nexus returns URL based on the request context, so direct access from adapter to k8s service
            # leads to incorrect project link starting from 'http://nexus.nexus.svc.cluster.local/...'
            # which is inacessible for external requests
            location /integration/adapters/nexus-ci/service/rest/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header Host onework.voda.ru;
                rewrite ^ $request_uri;
                rewrite ^/integration/adapters/nexus-ci/service/rest/(.*) $1 break;
                return 400;
                proxy_pass http://localhost/ssd/tools/nexus-ci/service/rest/$uri;
            }

            location /integration/adapters/nexus-ci/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/ssd/tools/nexus-ci/;
            }
            location /ssd/tools/nexus-cd/ {
                
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                proxy_pass http://localhost/ssd/tools/nexus-cd/;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            location /ssd/tools/nexus-cd/repository/ {
                
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                proxy_pass http://localhost/ssd/tools/nexus-cd/repository/;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            location /ssd/tools/nexus-cd/service/rest/ {
                
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                rewrite ^ $request_uri;
                rewrite ^/ssd/tools/nexus-cd/service/rest/(.*) $1 break;
                return 400;
                proxy_pass http://localhost/ssd/tools/nexus-cd/service/rest/$uri;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            location /ssd/tools/nexus-cd/repositoryplain/ {
                client_max_body_size 1000M;
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port  443;
                proxy_pass http://localhost/ssd/tools/nexus-cd/repository/;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            }

            # Nexus returns URL based on the request context, so direct access from adapter to k8s service
            # leads to incorrect project link starting from 'http://nexus.nexus.svc.cluster.local/...'
            # which is inacessible for external requests
            location /integration/adapters/nexus-cd/service/rest/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header Host onework.voda.ru;
                rewrite ^ $request_uri;
                rewrite ^/integration/adapters/nexus-cd/service/rest/(.*) $1 break;
                return 400;
                proxy_pass http://localhost/ssd/tools/nexus-cd/service/rest/$uri;
            }

            location /integration/adapters/nexus-cd/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/ssd/tools/nexus-cd/;
            }

            location /ssd/tools/fose/ {
                
                proxy_pass http://localhost/ssd/tools/fose/;
            }

            location /ssd/tools/fose/api/ {
                
                client_max_body_size 10M;
                proxy_pass http://localhost/ssd/tools/fose/api/;
            }

            location /ssd/tools/fose/proxy/ {
                
                client_max_body_size 10M;
                proxy_pass http://localhost/ssd/tools/fose/proxy/;
            }

            location /integration/adapters/fose/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port 443;
                proxy_set_header X-Forwarded-Ssl on;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/ssd/tools/fose/;
            }

           location /ssd/tools/dpm/ {
                if ($request_uri ~ "/ssd/tools/dpm(/$|$)") {
                  return 301 /ssd/tools/dpm/front/main/all;
                }
                
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header Host onework.voda.ru;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://localhost/;
            }

           location /ssd/tools/dpm/front {
               
               proxy_set_header X-Forwarded-Proto https;
               proxy_set_header Host onework.voda.ru;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
               proxy_pass http://localhost;
           }

           location /ssd/tools/dpm/api/ {
               
               client_max_body_size 10M;
               proxy_set_header X-Forwarded-Proto https;
               proxy_set_header Host onework.voda.ru;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
               proxy_pass http://localhost/;
           }

           location /ssd/tools/dpm/auth/ {
               
               proxy_set_header X-Forwarded-Proto https;
               proxy_set_header Host onework.voda.ru;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
               proxy_pass http://localhost/;
           }

            location /integration/adapters/dpm/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port 443;
                proxy_set_header X-Forwarded-Ssl on;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/dpm/;
            }
    
            location /integration/adapters/dpm-auth/ {
                proxy_set_header X-Forwarded-Proto https;
                proxy_set_header X-Forwarded-Port 443;
                proxy_set_header X-Forwarded-Ssl on;
                proxy_set_header Host onework.voda.ru;
                proxy_pass http://localhost/dpm/;
            }

           location /ssd/tools/viewwork/ {
                
                proxy_buffer_size  16k;
                proxy_buffers   4 16k;
                proxy_busy_buffers_size  16k;
                proxy_pass http://localhost/ssd/tools/viewwork/;
            }

            location /ssd/tools/mock/ {
                
                proxy_pass http://localhost/mock/;
            }

           location /ssd/tools/pact/ {
                
                proxy_pass http://localhost/pact/;
            }
    
            location /ssd/tools/loadtest/ {
                 
                 proxy_set_header Host onework.voda.ru;
                 proxy_set_header Referer https://onework.voda.ru/ssd/tools/loadtest/;
                 proxy_pass http://localhost/ssd/tools/loadtest/;
             }

            location /ssd/tools/loadtest/back/ {
                 
                 proxy_set_header Host onework.voda.ru;
                 proxy_set_header Referer https://onework.voda.ru/ssd/tools/loadtest/back/;
                 proxy_pass http://localhost/ssd/tools/loadtest/back/;
             }

            location /ssd/tools/loadtest/launcher/ {
                 
                 proxy_set_header Host onework.voda.ru;
                 proxy_set_header Referer https://onework.voda.ru/ssd/tools/loadtest/launcher/;
                 proxy_pass http://localhost/ssd/tools/loadtest/launcher/;
             }

            location /ssd/tools/loadtest/pusher/ {
                 
                 proxy_set_header Host onework.voda.ru;
                 proxy_set_header Referer https://onework.voda.ru/ssd/tools/loadtest/pusher/;
                 proxy_pass http://localhost/ssd/tools/loadtest/pusher/;
             }

            location = /ssd/tools/jazz/tokens/access {
                  
                  add_header Content-Type application/json;
                  proxy_pass http://localhost;
            }

            
            #location /ssd/tools/newtool {
            #    access_by_lua_block { loadfile('/opt/ssd-proxy-service/src/iam/assign_auth_header_v3.lua')(); }
            #    proxy_pass http://tool.tool.svc.cluster.local/ssd/tools/newtool;
            #}
            location = /ssd/ssd-ui-admin/v2/logout {
                access_by_lua_block {
                    if ngx.var['cookie_CONVEYOR_LOGOUT'] ~= 'true' then
                        ngx.header["Set-Cookie"] = "CONVEYOR_LOGOUT=true;Path=/ssd;HttpOnly=true;Secure=true;SameSite=LaX;Max-Age=1d"
                    end
                    ngx.status = 200
                    ngx.say('{ "httpStatusWrap": { "value": 200, "reasonPhrase": "OK", "error": false }, "serviceResponseError": null,  "returned": "true" }')
                    ngx.header.content_type = 'application/JSON';
                    ngx.exit(200);
                }
            }
            
        }
    }

  accountDisabled.html: |-
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Platform V Works - Account disabled</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
    </head>
    <body class="">
    <div class="login-pf-page">
        <div class="card-pf">
            <header class="login-pf-header">
                <h1 id="kc-page-title">
                    Ошибка доступа
                </h1>
            </header>
            <div id="kc-content">
                <div id="kc-content-wrapper" align="center">
                    Учетная запись пользователя заблокирована.<br>
                    Пожалуйста, обратитесь к координатору и повторите попытку <a href="/ssd/">входа</a>
                </div>
            </div>
        </div>
    </div>
    </body>
    </html>

  forbidden.html: |-
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Platform V Works - Forbidden</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
    </head>
    <body class="">
    <div class="login-pf-page">
        <div class="card-pf">
            <header class="login-pf-header">
                <h1 id="kc-page-title">
                    Ошибка доступа
                </h1>
            </header>
            <div id="kc-content">
                <div id="kc-content-wrapper" align="center">
                    Доступ к запрашиваемой странице запрещён.<br>
                    Пожалуйста, вернитесь <a id="goback" href="#" onclick="history.go(-1)">назад</a> или перейдите на главную <a href="/ssd/">страницу</a>
                </div>
            </div>
        </div>
    </div>
    </body>
    </html>

  notfound.html: |-
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Platform V Works - Not found</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
    </head>
    <body class="">
    <div class="login-pf-page">
        <div class="card-pf">
            <header class="login-pf-header">
                <h1 id="kc-page-title">
                    Ошибка доступа
                </h1>
            </header>
            <div id="kc-content">
                <div id="kc-content-wrapper" align="center">
                    Страница не найдена или доступ к ней запрещён.<br>
                    Пожалуйста, вернитесь <a id="goback" href="#" onclick="history.go(-1)">назад</a> или перейдите на главную <a href="/ssd/">страницу</a>
                </div>
            </div>
        </div>
    </div>
    </body>
    </html>

  sessionExpired.html: |-
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Platform V Works - Session expired</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
    </head>
    <body class="">
    <div class="login-pf-page">
        <div class="card-pf">
            <header class="login-pf-header">
                <h1 id="kc-page-title">
                    Время действия сессии истекло
                </h1>
            </header>
            <div id="kc-content">
                <div id="kc-content-wrapper" align="center">
                    Пожалуйста, осуществите вход <a href="/ssd/logout">повторно</a>
                </div>
            </div>
        </div>
    </div>
    </body>
    </html>

  sessionLimits.html: |-
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Platform V Works - Session limits</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
    </head>
    <body class="">
    <div class="login-pf-page">
        <div class="card-pf">
            <header class="login-pf-header">
                <h1 id="kc-page-title">
                    Ошибка доступа
                </h1>
            </header>
            <div id="kc-content">
                <div id="kc-content-wrapper" align="center">
                    Попытка входа нарушает политику конкурентных учётных записей - достигнут лимит активных пользователей для домена
                    <b>
                        <script src="/ssd/proxy-static/js/dompurify/dist/purify.min.js"></script>
                        <script type="text/javascript"> document.write(DOMPurify.sanitize(new URLSearchParams(window.location.search).get('domain'))) </script>
                    </b>
                    <br><br>
                    Пожалуйста, попробуйте <a href="/ssd/login">войти</a> позже
                </div>
            </div>
        </div>
    </div>
    </body>
    </html>

  unauthorized.html: |-
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Platform V Works - Unauthorized</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
    </head>
    <body class="">
    <div class="login-pf-page">
        <div class="card-pf">
            <header class="login-pf-header">
                <h1 id="kc-page-title">
                    Ошибка доступа
                </h1>
            </header>
            <div id="kc-content">
                <div id="kc-content-wrapper" align="center">
                    Пожалуйста, перейдите на главную <a href="/ssd/">страницу</a>
                </div>
            </div>
        </div>
    </div>
    </body>
    </html>

  checkEmail.html: |-
    <!DOCTYPE html>
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">
      <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Проверьте свою почту</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/checkEmail.css" rel="stylesheet" />
        <link href="styles/resetPassword.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
      </head>
      <body>
        <div class="login-pf-page">
          <div class="card-pf">
            <header class="login-pf-header">
              <h1 id="kc-page-title">Проверьте свою почту</h1>
            </header>
            <div id="kc-content-svg">
              <svg
                width="90.212891"
                height="91.439941"
                viewBox="0 0 90.2129 91.4399"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <desc>Created with Pixso.</desc>
                <defs />
                <path
                  id="Rectangle 1"
                  d="M0 33.61C34.92 23.67 54.77 23.63 90.21 33.61L90.21 78.72L0 78.72L0 33.61Z"
                  fill="#EBB134"
                  fill-opacity="1.000000"
                  fill-rule="evenodd"
                />
                <path
                  id="Vector 4"
                  d="M0 33.62C30.07 33.93 90.21 34.38 90.21 33.62C90.21 32.86 51.73 0 44.89 0C38.05 0 0 33.62 0 33.62Z"
                  fill="#F7B82F"
                  fill-opacity="1.000000"
                  fill-rule="evenodd"
                />
                <rect
                  id="Rectangle 1"
                  x="14.468262"
                  y="9.975220"
                  width="61.276752"
                  height="68.936333"
                  fill="#EDEDED"
                  fill-opacity="1.000000"
                />
                <circle
                  id="Oval 1"
                  cx="26.382812"
                  cy="26.996521"
                  r="2.553240"
                  fill="#C4C4C4"
                  fill-opacity="1.000000"
                />
                <circle
                  id="Oval 2"
                  cx="34.042480"
                  cy="26.996521"
                  r="2.553240"
                  fill="#C4C4C4"
                  fill-opacity="1.000000"
                />
                <circle
                  id="Oval 3"
                  cx="41.702637"
                  cy="26.996521"
                  r="2.553240"
                  fill="#C4C4C4"
                  fill-opacity="1.000000"
                />
                <circle
                  id="Oval 4"
                  cx="49.362305"
                  cy="26.996521"
                  r="2.553240"
                  fill="#C4C4C4"
                  fill-opacity="1.000000"
                />
                <circle
                  id="Oval 5"
                  cx="57.021973"
                  cy="26.996521"
                  r="2.553240"
                  fill="#C4C4C4"
                  fill-opacity="1.000000"
                />
                <circle
                  id="Oval 6"
                  cx="64.681641"
                  cy="26.996521"
                  r="2.553240"
                  fill="#C4C4C4"
                  fill-opacity="1.000000"
                />
                <rect
                  id="Rectangle 1"
                  x="14.468262"
                  y="42.553284"
                  width="61.276752"
                  height="37.446903"
                  fill="#FFFFFF"
                  fill-opacity="0.480000"
                />
                <path
                  id="Vector 2"
                  d="M0 33.61L0 91.06L44.25 67.23L0 33.61Z"
                  fill="#F9C643"
                  fill-opacity="1.000000"
                  fill-rule="evenodd"
                />
                <path
                  id="Vector 3"
                  d="M90.21 33.61L90.21 91.06L45.95 67.23L90.21 33.61Z"
                  fill="#F9C643"
                  fill-opacity="1.000000"
                  fill-rule="evenodd"
                />
                <path
                  id="Vector 1"
                  d="M0.42 91.06C30.35 91.34 90.21 91.74 90.21 91.06C90.21 90.38 51.91 60.85 45.1 60.85C38.29 60.85 0.42 91.06 0.42 91.06Z"
                  fill="#EBB134"
                  fill-opacity="1.000000"
                  fill-rule="evenodd"
                />
              </svg>
            </div>
            <div>
              <p id="message">
                Ссылка для восстановления пароля успешно отправлена на указанную
                вами почту
              </p>
            </div>
            <div id="kc-form-buttons" class="form-group">
              <button
                class="pf-c-button pf-m-primary pf-m-block btn-lg auth-button"
                onclick="window.location.href='/ssd/login'"
              >
                Авторизоваться
              </button>
            </div>
          </div>
        </div>
      </body>
    </html>

  login.html: |-
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">
      <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Platform V Works</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
      </head>
      <script src="/ssd/proxy-static/js/dompurify/dist/purify.min.js"></script>
      <script type="text/javascript">
        function setRedirectUrl() {
          const urlParams = new URLSearchParams(window.location.search);
          const redirectUrlValue = DOMPurify.sanitize(urlParams.get("redirectUrl"));
          if (redirectUrlValue) {
            document.getElementById("redirectUrl").value = redirectUrlValue;
          }
        }
      </script>
      <body class="" onload="setRedirectUrl()">
        <div class="login-pf-page">
          <div class="card-pf">
            <header class="login-pf-header">
              <h1 id="kc-page-title">Platform V Works</h1>
            </header>
            <div id="kc-content">
              <div id="kc-content-wrapper">
                <div id="kc-form">
                  <div id="kc-form-wrapper">
                    <form
                      id="kc-form-login"
                      onsubmit="login.disabled = true; return true;"
                      action="/ssd/auth"
                      method="POST"
                    >
                      <div class="form-group">
                        <label
                          for="username"
                          class="pf-c-form__label pf-c-form__label-text"
                          >Имя пользователя</label
                        >

                        <input
                          tabindex="1"
                          id="username"
                          class="pf-c-form-control"
                          name="username"
                          value=""
                          type="text"
                          autofocus
                          autocomplete="off"
                          aria-invalid=""
                          required
                          oninvalid="setCustomValidity('Введите имя пользователя')"
                          oninput="setCustomValidity('')"
                        />
                      </div>

                      <div class="form-group">
                        <label
                          for="password"
                          class="pf-c-form__label pf-c-form__label-text"
                          >Пароль</label
                        >
                        <input id="redirectUrl" type="hidden" name="redirectUrl" />
                        <input
                          tabindex="2"
                          id="password"
                          class="pf-c-form-control"
                          name="password"
                          type="password"
                          autocomplete="off"
                          aria-invalid=""
                          required
                          oninvalid="setCustomValidity('Введите пароль')"
                          oninput="setCustomValidity('')"
                        />
                      </div>

                      <div id="kc-form-buttons" class="form-group">
                        <input
                          type="hidden"
                          id="id-hidden-input"
                          name="credentialId"
                        />
                        <input
                          tabindex="4"
                          class="pf-c-button pf-m-primary pf-m-block btn-lg"
                          name="login"
                          id="kc-login"
                          type="submit"
                          value="Вход"
                        />
                      </div>
                    </form>
                  </div>
                </div>
                <div id="forgot-password">
                  <a href="/ssd/reset-password">Забыли пароль?</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </body>
    </html>

  offlineTokenGeneration.html: |-
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Platform V Works</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
    </head>
    <body class="">
    <div class="login-pf-page">
        <div class="card-pf">
            <header class="login-pf-header">
                <h1 id="kc-page-title">
                    Platform V Works - Генерация токена пользователя
                </h1>
            </header>
            <div id="kc-content">
                <div id="kc-content-wrapper">
                    <div id="kc-form">
                        <div id="kc-token-wrapper">
                            <form id="kc-token-gen" onsubmit="login.disabled = true; return true;" action="/ssd/offlineToken" method="POST">

                                <div class="form-group">
                                    <label for="password" class="pf-c-form__label pf-c-form__label-text">Пароль</label>
                                    <input tabindex="2" id="password" class="pf-c-form-control" name="password" type="password" autocomplete="off"
                                           aria-invalid=""
                                           required
                                           oninvalid="setCustomValidity('Введите пароль')"
                                           oninput="setCustomValidity('')"
                                    />
                                </div>

                                <div id="kc-form-buttons" class="form-group">
                                    <input type="hidden" id="id-hidden-input" name="credentialId" />
                                    <input tabindex="4" class="pf-c-button pf-m-primary pf-m-block btn-lg" name="login" id="kc-login" type="submit" value="Сгенерировать токен"/>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    </body>
    </html>

  resetPassword.html: |-
    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    <html xmlns="http://www.w3.org/1999/xhtml" class="login-pf">
      <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="robots" content="noindex, nofollow" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Platform V Works</title>
        <link href="styles/base.css" rel="stylesheet" />
        <link href="styles/resetPassword.css" rel="stylesheet" />
        <link href="styles/app.css" rel="stylesheet" />
        <link href="styles/patternfly.min.css" rel="stylesheet" />
        <link href="styles/patternfly-additions.min.css" rel="stylesheet" />
        <link href="styles/pficon.css" rel="stylesheet" />
        <link href="styles/login.css" rel="stylesheet" />
        <link href="styles/tile.css" rel="stylesheet" />
      </head>
      <script src="/ssd/proxy-static/js/dompurify/dist/purify.min.js"></script>
      <script type="text/javascript">
        async function handleSubmit(event) {
          event.preventDefault();

          const form = event.target;
          const email = DOMPurify.sanitize(document.getElementById("email").value);
          const data = { email: email };

          try {
            const response = await fetch(form.action, {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            });

            if (!response.ok) {
              throw new Error("Network response was not ok " + response.statusText);
            }

            window.location.href = "/ssd/reset-password-email";
          } catch (error) {
            alert("Что-то пошло не так, попробуйте еще раз");
            console.error("Error:", error);
          }
        }

        function validateEmail(email) {
          const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailPattern.test(email);
        }

        document.addEventListener("DOMContentLoaded", function () {
          const input = document.getElementById("email");
          const button = document.getElementById("kc-login");

          function toggleButtonState() {
            if (validateEmail(input.value)) {
              button.disabled = false;
            } else {
              button.disabled = true;
            }
          }

          input.addEventListener("input", toggleButtonState);
          toggleButtonState();
        });
      </script>
      <body class="">
        <div class="login-pf-page">
          <div class="card-pf">
            <header class="login-pf-header">
              <h1 id="kc-page-title">Восстановление пароля</h1>
              <p id="kc-page-subtitle">
                Введите ваш email, мы отправим на него ссылку для восстановления
                пароля
              </p>
            </header>
            <div id="kc-content">
              <div id="kc-content-wrapper">
                <div id="kc-form">
                  <div id="kc-form-wrapper">
                    <form
                      id="kc-form-login"
                      onsubmit="handleSubmit(event)"
                      action="/ssd/send-reset-password"
                    >
                      <div class="form-group">
                        <input
                          tabindex="1"
                          id="email"
                          class="pf-c-form-control"
                          name="email"
                          value=""
                          type="email"
                          autofocus
                          autocomplete="off"
                          aria-invalid="false"
                          required
                          placeholder="Введите email"
                          oninvalid="setCustomValidity('Введите email')"
                          oninput="setCustomValidity('')"
                        />
                        <div id="email-error" style="color: red; display: none">
                          Введите корректный email
                        </div>
                      </div>

                      <div id="kc-form-buttons" class="form-group">
                        <button
                          tabindex="4"
                          class="pf-c-button pf-m-primary pf-m-block btn-lg"
                          id="kc-login"
                          type="submit"
                          disabled
                        >
                          Отправить
                        </button>

                        <a id="kc-redirect-to-auth" href="/ssd/login"
                          >Вернуться на авторизацию</a
                        >
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </body>
    </html>

  logrotate.conf: | 
    /var/log/ssd-v2/ssd-proxy-ws/access.log {
      rotate 5
      size 10M
      missingok
      copytruncate
      nocreate
      nodelaycompress
      nomail
      notifempty
      noolddir
      compress
      postrotate
            echo "Log /var/log/ssd-v2/ssd-proxy-ws/access.log was logrotated" && openresty -s reload
      endscript
    } 
    /var/log/ssd-v2/ssd-proxy-ws/error.log {
      rotate 5
      size 10M
      missingok
      copytruncate
      nocreate
      nodelaycompress
      nomail
      notifempty
      noolddir
      compress
      postrotate
            echo "Log /var/log/ssd-v2/ssd-proxy-ws/error.log was logrotated" && openresty -s reload
      endscript
    }
